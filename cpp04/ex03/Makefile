.PHONY : all bonus clean fclean re

NAME := a.out

# â•­â”â”â”â”â”â”â”â”â”â”â”â”â•â•â•â•â•â•â•â•â•â•â••å‡º â– BASICS VARIABLES â– åŠ›â•’â•â•â•â•â•â•â•â•â•â•â•â”â”â”â”â”â”â”â”â”â”â”â”â•® #

CXX				:=	c++

CXXFLAGS		:=	-Wall -Wextra -Werror -std=c++98

RM				:=	rm	-rf

MKDIR			:=	mkdir -p

SHOW_MSG_CLEAN	=	true

MAKEFLAGS		+=	--no-print-directory

# â•°â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•›å‡º â– åŠ›â•˜â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•¯ #

# â•­â”â”â”â”â”â”â”â”â”â”â”â”â•â•â•â•â•â•â•â•â•â•â••å‡º â– FILE TREE â– åŠ›â•’â•â•â•â•â•â•â•â•â•â•â•â”â”â”â”â”â”â”â”â”â”â”â”â•® #

D_SRC		=	src/
D_INC		=	include/

D_OBJ		=	.objs/

vpath %.cpp $(D_SRC):$(D_SRC)Classes:$(D_SRC)Classes/Materias:$(CURDIR)
vpath %.hpp $(D_INC):$(D_INC)Interfaces:$(D_INC)Materias

# file lists
SRCS		=	main.cpp			\
				Ice.cpp				\
				Cure.cpp			\
				AMateria.cpp		\
				Character.cpp		\
				MateriaSource.cpp

INCS		=	$(addprefix $(D_INC), Character.hpp MateriaSource.hpp)									\
				$(addprefix $(D_INC)Materias/, AMateria.hpp Cure.hpp Ice.hpp)			\
				$(addprefix $(D_INC)Interfaces/, ICharacter.hpp IMateriaSource.hpp)

OBJS		=	$(addprefix $(D_OBJ), $(SRCS:.cpp=.o))

INC			=	-I$(D_INC) -I$(D_INC)Materias -I$(D_INC)Interfaces

# â•­â”â”â”â”â”â”â”â”â”â”â”â”â•â•â•â•â•â•â•â•â•â•â••å‡º â– RULES â– åŠ›â•’â•â•â•â•â•â•â•â•â•â•â•â”â”â”â”â”â”â”â”â”â”â”â”â•® #

all:	$(NAME)

$(NAME):	$(OBJS) $(INCS) | Makefile $(D_OBJ)
	@$(CXX) $(CXXFLAGS) $(INC) $(OBJS) -o $(NAME)
	@echo "\e[1;32mğŸ $(NAME) program created successfully ! ğŸ\e[0m"

$(D_OBJ):
	@$(MKDIR) $(D_OBJ)

$(D_OBJ)%.o: %.cpp | Makefile $(D_OBJ)
	@echo "\e[1mğŸ«§ Compiling $< ğŸ«§\e[0m"
	@$(CXX) $(CXXFLAGS) $(INC) -c $< -o $@

clean:
	@$(RM) $(D_OBJ)
	@echo "\e[1;36mğŸ«— Deleted $(NAME) object files ğŸ«—\e[0m"

fclean:
	@$(MAKE) -s SHOW_MSG_CLEAN=false clean
	@$(RM) $(NAME)
	@echo "\e[1;34mğŸ§¼ $(NAME) executable deleted ! ğŸ§¼\e[0m"

re:
	@$(MAKE) fclean
	@$(MAKE) all

valgrind:
	@$(MAKE)
	@clear
	@valgrind										\
		--leak-check=full								\
		--show-leak-kinds=all							\
		--track-origins=yes 							\
		--track-fds=yes									\
		./$(NAME)
